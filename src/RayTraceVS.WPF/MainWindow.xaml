<Window x:Class="RayTraceVS.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RayTraceVS.WPF"
        xmlns:views="clr-namespace:RayTraceVS.WPF.Views"
        mc:Ignorable="d"
        Title="RayTraceVS - DirectX12 DXR Visual Raytracing" 
        Height="900" Width="1600"
        MinWidth="800" MinHeight="600"
        ResizeMode="CanResizeWithGrip"
        WindowState="Normal"
        Background="{StaticResource BackgroundBrush}"
        PreviewKeyDown="Window_PreviewKeyDown"
        KeyDown="Window_KeyDown">
    
    <DockPanel>
        <!-- メニューバー -->
        <Menu DockPanel.Dock="Top" Background="{StaticResource PanelBrush}">
            <Menu.Resources>
                <Style TargetType="MenuItem">
                    <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                    <Setter Property="Background" Value="{StaticResource PanelBrush}"/>
                </Style>
            </Menu.Resources>
            
            <MenuItem Header="ファイル(_F)">
                <MenuItem Header="新規シーン(_N)" Click="NewScene_Click" InputGestureText="Ctrl+N"/>
                <MenuItem Header="開く(_O)..." Click="OpenScene_Click" InputGestureText="Ctrl+O"/>
                <MenuItem Header="保存(_S)" Click="SaveScene_Click" InputGestureText="Ctrl+S"/>
                <MenuItem Header="名前を付けて保存(_A)..." Click="SaveSceneAs_Click" InputGestureText="Ctrl+Shift+S"/>
                <Separator/>
                <MenuItem Header="終了(_X)" Click="Exit_Click" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="編集(_E)">
                <MenuItem Header="元に戻す(_U)" Click="Undo_Click" InputGestureText="Ctrl+Z"/>
                <MenuItem Header="やり直し(_R)" Click="Redo_Click" InputGestureText="Ctrl+Shift+Z"/>
                <Separator/>
                <MenuItem Header="コピー(_C)" Click="Copy_Click" InputGestureText="Ctrl+C"/>
                <MenuItem Header="貼り付け(_P)" Click="Paste_Click" InputGestureText="Ctrl+V"/>
                <Separator/>
                <MenuItem Header="削除(_D)" Click="Delete_Click" InputGestureText="Delete"/>
            </MenuItem>
            <MenuItem Header="表示(_V)">
                <MenuItem x:Name="ToggleLeftPanelMenuItem" Header="コンポーネントパレット(_C)" IsCheckable="True" IsChecked="True" Click="ToggleLeftPanel_Click"/>
                <MenuItem x:Name="ToggleRightPanelMenuItem" Header="プロパティパネル(_P)" IsCheckable="True" IsChecked="True" Click="ToggleRightPanel_Click"/>
            </MenuItem>
            <MenuItem Header="レンダリング(_R)">
                <MenuItem Header="レンダリング開始(_S)" Click="StartRendering_Click"/>
                <MenuItem Header="レンダリング停止(_P)" Click="StopRendering_Click"/>
                <Separator/>
                <MenuItem Header="レンダリング設定(_O)..."/>
            </MenuItem>
            <MenuItem Header="ヘルプ(_H)">
                <MenuItem Header="バージョン情報(_A)"/>
            </MenuItem>
        </Menu>

        <!-- ツールバー：再生・停止・スクリーンショットボタン -->
        <Border DockPanel.Dock="Top" Background="#252526" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <Grid Height="36">
                <!-- 中央寄せのコントロールボタン -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- 再生ボタン -->
                    <Button x:Name="PlayButton" Width="36" Height="28" Margin="2,0"
                            Click="PlayButton_Click" ToolTip="レンダリング開始 (F5)">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderBrush" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Cursor" Value="Hand"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="3">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#3E3E42"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#007ACC"/>
                                                </Trigger>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                        <Path Data="M8,5.14V19.14L19,12.14L8,5.14Z" Fill="#4EC9B0" Stretch="Uniform" Width="14" Height="14"/>
                    </Button>
                    
                    <!-- 停止ボタン -->
                    <Button x:Name="StopButton" Width="36" Height="28" Margin="2,0" IsEnabled="False"
                            Click="StopButton_Click" ToolTip="レンダリング停止 (Shift+F5)">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderBrush" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Cursor" Value="Hand"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="3">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#3E3E42"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#D64541"/>
                                                </Trigger>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                        <Rectangle Width="12" Height="12" Fill="#D64541"/>
                    </Button>
                    
                    <!-- セパレータ -->
                    <Rectangle Width="1" Height="20" Fill="#3F3F46" Margin="8,0"/>
                    
                    <!-- スクリーンショット保存ボタン -->
                    <Button x:Name="ScreenshotButton" Width="36" Height="28" Margin="2,0" IsEnabled="False"
                            Click="ScreenshotButton_Click" ToolTip="レンダリング画像を保存 (Ctrl+Shift+P)">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderBrush" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Cursor" Value="Hand"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="3">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#3E3E42"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#007ACC"/>
                                                </Trigger>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                        <!-- カメラアイコン (スクリーンショット/写真を撮る意味) -->
                        <Path Data="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z" 
                              Fill="#C586C0" Stretch="Uniform" Width="16" Height="16"/>
                    </Button>
                </StackPanel>
                
                <!-- 右側の解像度表示 -->
                <TextBlock Text="1920 x 1080" FontSize="11" Foreground="#888888" 
                           HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,12,0"/>
            </Grid>
        </Border>

        <!-- ステータスバー -->
        <StatusBar DockPanel.Dock="Bottom" Background="{StaticResource PanelBrush}">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="準備完了" Foreground="{StaticResource TextBrush}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="NodeCountText" Text="ノード: 0" Foreground="{StaticResource TextBrush}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="FpsText" Text="FPS: 0" Foreground="{StaticResource TextBrush}"/>
            </StatusBarItem>
        </StatusBar>

        <!-- メインコンテンツ：3パネルレイアウト -->
        <Grid x:Name="MainGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="LeftPanelColumn" Width="250"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition x:Name="RightPanelColumn" Width="300"/>
            </Grid.ColumnDefinitions>

            <!-- 左パネル：コンポーネントパレット -->
            <Border x:Name="LeftPanelBorder" Grid.Column="0" Background="{StaticResource PanelBrush}" 
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
                <views:ComponentPaletteView x:Name="ComponentPalette"/>
            </Border>

            <GridSplitter x:Name="LeftSplitter" Grid.Column="1" Width="5" HorizontalAlignment="Stretch" 
                          Background="{StaticResource BorderBrush}"/>

            <!-- 中央パネル：ノードエディタ -->
            <Border Grid.Column="2" Background="{StaticResource BackgroundBrush}" ClipToBounds="True">
                <views:NodeEditorView x:Name="NodeEditor"/>
            </Border>

            <GridSplitter x:Name="RightSplitter" Grid.Column="3" Width="5" HorizontalAlignment="Stretch" 
                          Background="{StaticResource BorderBrush}"/>

            <!-- 右パネル：プロパティパネル -->
            <Border x:Name="RightPanelBorder" Grid.Column="4" Background="{StaticResource PanelBrush}" 
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,0,0,0">
                <views:PropertyPanelView x:Name="PropertyPanel"/>
            </Border>
        </Grid>
    </DockPanel>
</Window>
