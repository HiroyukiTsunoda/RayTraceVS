# RayTraceVS - DirectX12 DXR Visual Raytracing

WPFベースのビジュアルスクリプティングUIと、DirectX12 DXRを使用したGPUレイトレーシングエンジンを組み合わせたWindowsアプリケーションです。

## 概要

- **プロジェクト名**: RayTraceVS
- **開発環境**: Visual Studio 2026
- **言語**: C# 12 (.NET 8) / C++ 20
- **グラフィックスAPI**: DirectX 12 + DXR (DirectX Raytracing) 1.1

## 主な機能

- UEのBlueprintライクなノードエディタでシーンを構築
- リアルタイムGPUレイトレーシングでのレンダリング
- 球、平面、円柱などの基本オブジェクト
- 複数光源のサポート
- 鏡面反射と屈折（透明マテリアル）
- マテリアルシステム（色、反射率、透明度、屈折率）

## プロジェクト構造

```
RayTraceVS/
├── RayTraceVS.sln                          # Visual Studioソリューション
├── src/
│   ├── RayTraceVS.WPF/                     # C# WPFプロジェクト
│   │   ├── ViewModels/                     # MVVM ViewModels
│   │   ├── Views/                          # WPF Views
│   │   ├── Controls/                       # カスタムコントロール
│   │   ├── Models/                         # データモデル
│   │   │   └── Nodes/                      # ノードタイプ
│   │   └── Services/                       # サービス層
│   │
│   ├── RayTraceVS.DXEngine/                # C++ DirectX12プロジェクト
│   │   ├── DXContext.h/.cpp                # DX12初期化
│   │   ├── DXRPipeline.h/.cpp              # DXRパイプライン
│   │   ├── AccelerationStructure.h/.cpp    # BLAS/TLAS構築
│   │   ├── Scene/                          # シーン管理
│   │   └── Shaders/                        # HLSLシェーダー
│   │
│   └── RayTraceVS.Interop/                 # C++/CLI相互運用プロジェクト
│       ├── EngineWrapper.h/.cpp            # エンジンラッパー
│       ├── SceneData.h                     # データ構造
│       └── Marshalling.h/.cpp              # データ変換
│
└── Resources/                              # リソースファイル
    └── Icons/                              # ノードアイコン
```

## 必須要件

- Windows 10 2004以降（DXR対応）
- DirectX 12対応GPU（RTXシリーズ推奨、GTX 1060以降でも可）
- Visual Studio 2022以降
- .NET 8.0 SDK
- 最新のグラフィックスドライバ

## ビルド手順

1. Visual Studio 2022以降を起動
2. `RayTraceVS.sln` を開く
3. ソリューション構成: **Release** (または Debug)
4. プラットフォーム: **x64**
5. ビルド → ソリューションのビルド（F7）

## 実行方法

- スタートアッププロジェクト: **RayTraceVS.WPF**
- F5キーでデバッグ実行
- Ctrl+F5でデバッグなし実行

詳しい使い方については **[使い方.md](使い方.md)** を参照してください。

## 使い方

### サンプルシーンを試す（初めての方向け）

1. アプリケーションを起動
2. メニューから「ファイル → 開く」を選択
3. `sample_scene.rtvs` を開く
4. ノードエディタにサンプルシーン（球1つ、平面1つ）が表示されます
5. メニューから「レンダリング → レンダリング開始」を選択
6. レンダリングウィンドウが開き、レイトレーシング結果が表示されます

### ノードエディタ

1. 左パネルのコンポーネントパレットからノードを選択
2. 中央のノードエディタキャンバスにドラッグ&ドロップで配置
3. ノード間のソケットをドラッグして接続を作成
4. 右パネルでノードのプロパティを編集

### レンダリング

1. シーンノードを配置してオブジェクトとカメラを接続
2. メニューから「レンダリング → レンダリング開始」
3. レンダリング結果が別ウィンドウに表示されます

### ノードの接続方法

- オブジェクトノード（球、平面、円柱）の出力ソケットを、シーンノードの「オブジェクト1」「オブジェクト2」「オブジェクト3」入力ソケットに接続
- カメラノードの出力ソケットを、シーンノードの「カメラ」入力ソケットに接続
- ライトノードの出力ソケットを、シーンノードの「ライト1」「ライト2」入力ソケットに接続

### ノードタイプ

- **オブジェクト**: 球、平面、円柱
- **数学**: Vector3、加算、乗算
- **カメラ**: 視点設定
- **ライト**: ポイントライト
- **シーン**: 最終出力

## 技術的詳細

### DirectX12 DXR レイトレーシング

- **DXR 1.1**: DirectX Raytracingを使用
- **アクセラレーション構造**: BLAS/TLASによる高速化
- **カスタム交差シェーダー**: 球と円柱の解析的交差判定
- **再帰的レイトレーシング**: 反射と屈折の実装

### シェーダー

- **RayGen**: レイ生成シェーダー
- **ClosestHit**: 最近接ヒットシェーダー（ライティング計算）
- **Miss**: ミスシェーダー（背景色）
- **Intersection**: カスタム交差シェーダー（球、円柱）

### WPF ノードエディタ

- **Canvas**: ノード配置
- **MVVM**: CommunityToolkit.Mvvm使用
- **グラフ評価**: 依存関係を解決して評価

## 今後の拡張

- メッシュインポート（.obj, .fbx）
- テクスチャマッピング
- グローバルイルミネーション（パストレーシング）
- アニメーション機能
- リアルタイムプレビュー

## ライセンス

MIT License

## 作者

RayTraceVS Development Team
